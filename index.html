<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PreçoVs</title>

<style>
:root {
  --bg-main: #050505;
  --bg-header: #0a0a0a;
  --bg-section: #0f0f10;
  --bg-card: #151518;
  --bg-card-soft: #111115;
  --border-soft: #27272a;
  --text-main: #e5e5e5;
  --text-muted: #9ca3af;
  --accent-green: #22c55e;
  --accent-soft: #2e2e2e;
  --accent-strong: #ffffff;
}

/* GLOBAL */
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
  color: var(--text-main);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

/* Containers */
.page-section { max-width: 1400px; margin: 0 auto; padding: 32px 16px; }
.section-title { font-size: 1.7rem; margin-bottom: 10px; font-weight: 600; }
.section-subtitle { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 24px; }

/* ===========================
      HEADER
=========================== */
.top-header {
  background: var(--bg-header);
  padding: 12px 16px;
  color: white;
  border-bottom: 1px solid var(--border-soft);
}

.header-container {
  max-width: 1400px;
  margin: auto;
  display: flex;
  align-items: center;
  gap: 20px;
}

.logo {
  font-size: 1.8rem;
  font-weight: bold;
  color: white;
  letter-spacing: 0.03em;
}
.logo span { color: var(--accent-green); }

/* SEARCH */
.search-box { flex: 1; display: flex; }
.search-box input {
  flex: 1;
  padding: 10px;
  border: 1px solid #2e2e2e;
  background: #1a1a1a;
  color: white;
  border-radius: 6px 0 0 6px;
}
.search-box input::placeholder { color: #6b7280; }
.search-box button {
  padding: 10px 16px;
  border: none;
  background: #2e2e2e;
  color: white;
  border-radius: 0 6px 6px 0;
  cursor: pointer;
  font-weight: 500;
}
.search-box button:hover { background: #3b3b3b; }

/* ENDEREÇO */
.endereco {
  text-align: left;
  font-size: 0.85rem;
  line-height: 1.1rem;
  color: #e5e5e5;
  min-width: 140px;
}
.end-label { opacity: 0.6; }

/* ICONS AREA */
.account, .cart {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  color: #e5e5e5;
  font-size: 0.9rem;
}
.account span, .cart span { white-space: nowrap; }
.icon { width: 22px; height: 22px; filter: invert(100%); }

.cart { position: relative; }
.cart-count {
  position: absolute;
  top: -5px;
  right: -6px;
  background: #ef4444;
  padding: 2px 6px;
  font-size: 0.75rem;
  border-radius: 999px;
  font-weight: bold;
}

/* BARRA AVISO INTERMEDIADOR */
.info-bar { background: #020617; border-bottom: 1px solid var(--border-soft); }
.info-bar-inner {
  max-width: 1400px;
  margin: 0 auto;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 0.85rem;
  color: var(--text-muted);
}
.info-pill {
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid #1f2933;
  background: #020617;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.info-highlight { color: var(--accent-green); font-weight: 500; }

/* ===========================
      CARROSSEL
=========================== */
.carousel {
  position: relative;
  width: 100%;
  overflow: hidden;
  background: #000;
  border-bottom: 1px solid #111827;
}
.carousel-track { display: flex; transition: transform 0.5s ease; }
.carousel img {
  width: 100%;
  height: auto;
  object-fit: contain;
  display: block;
}
.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(15,23,42,0.6);
  border: 1px solid rgba(148,163,184,0.6);
  color: white;
  font-size: 2rem;
  padding: 8px 14px;
  cursor: pointer;
  border-radius: 999px;
  backdrop-filter: blur(6px);
}
.carousel-btn.prev { left: 18px; }
.carousel-btn.next { right: 18px; }
.carousel-btn:hover { background: rgba(15,23,42,0.9); }

/* ===========================
      HERO / CONCEITO
=========================== */
.hero {
  display: grid;
  grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
  gap: 28px;
  align-items: center;
}
.hero-left h1 { font-size: 2.2rem; margin-bottom: 12px; }
.hero-left h1 span { color: var(--accent-green); }
.hero-left p { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 18px; }

.hero-badges { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 22px; }
.hero-badge {
  font-size: 0.75rem;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--border-soft);
  background: var(--bg-card-soft);
  color: var(--text-muted);
}
.hero-actions { display: flex; flex-wrap: wrap; gap: 10px; }

.btn-primary {
  background: var(--accent-green);
  color: #020617;
  border: none;
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 0.9rem;
  cursor: pointer;
}
.btn-primary:hover { filter: brightness(1.05); }

.btn-outline {
  background: transparent;
  color: var(--accent-strong);
  border-radius: 999px;
  border: 1px solid var(--border-soft);
  padding: 9px 16px;
  font-size: 0.88rem;
  cursor: pointer;
}
.btn-outline:hover { background: #111827; }

.hero-right {
  background: radial-gradient(circle at top, #1f2937 0, #020617 65%);
  border-radius: 18px;
  padding: 16px 18px;
  border: 1px solid #1f2937;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.hero-right-title { font-size: 0.95rem; margin-bottom: 4px; }
.hero-compare-row {
  display: flex;
  justify-content: space-between;
  font-size: 0.85rem;
  padding: 8px 10px;
  border-radius: 10px;
  background: rgba(15,23,42,0.8);
  border: 1px solid #111827;
}
.hero-compare-row span.mercado { font-weight: 500; }
.hero-compare-row span.valor { font-feature-settings: "tnum" on, "lnum" on; }
.hero-compare-row.best { border-color: var(--accent-green); background: rgba(22,163,74,0.08); }
.hero-legend { font-size: 0.75rem; color: var(--text-muted); margin-top: 6px; }

/* ===========================
      SETORES — SEM SCROLL
=========================== */
.sectors-box {
  margin-top: 18px;
  background: rgba(15,23,42,0.55);
  border: 1px solid #1f2937;
  border-radius: 18px;
  padding: 16px;
  max-width: 100%;
  margin-left: 0;
  margin-right: auto;
}
.sectors-grid {
  display: grid;
  grid-template-columns: repeat(12, minmax(0, 1fr));
  gap: 10px;
  overflow: hidden;
}
.sector-card {
  position: relative;
  overflow: hidden;
  border-radius: 14px;
  border: 1px solid #1f2937;

  background-color: #000;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;

  aspect-ratio: 1 / 1;

  display: flex;
  align-items: flex-end;
  justify-content: center;

  padding: clamp(8px, 1vw, 14px) clamp(6px, 0.9vw, 10px);

  user-select: none;
  transition: transform 0.15s ease, border-color 0.15s ease;
}
.sector-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.78), rgba(0,0,0,0.18));
}
.sector-card span {
  position: relative;
  z-index: 1;
  font-size: clamp(0.55rem, 0.85vw, 0.88rem);
  font-weight: 650;
  color: var(--text-main);
  text-align: center;
  line-height: 1.1;
  padding: 0 4px;
}
.sector-card:hover { border-color: rgba(34,197,94,0.45); transform: translateY(-1px); }

/* imagens por ordem: setor1.png ... setor12.png */
.sectors-grid .sector-card:nth-child(1)  { background-image: url("setor1.png"); }
.sectors-grid .sector-card:nth-child(2)  { background-image: url("setor2.png"); }
.sectors-grid .sector-card:nth-child(3)  { background-image: url("setor3.png"); }
.sectors-grid .sector-card:nth-child(4)  { background-image: url("setor4.png"); }
.sectors-grid .sector-card:nth-child(5)  { background-image: url("setor5.png"); }
.sectors-grid .sector-card:nth-child(6)  { background-image: url("setor6.png"); }
.sectors-grid .sector-card:nth-child(7)  { background-image: url("setor7.png"); }
.sectors-grid .sector-card:nth-child(8)  { background-image: url("setor8.png"); }
.sectors-grid .sector-card:nth-child(9)  { background-image: url("setor9.png"); }
.sectors-grid .sector-card:nth-child(10) { background-image: url("setor10.png"); }
.sectors-grid .sector-card:nth-child(11) { background-image: url("setor11.png"); }
.sectors-grid .sector-card:nth-child(12) { background-image: url("setor12.png"); }

/* Responsivo SEM BARRA */
@media (max-width: 1200px) { .sectors-grid { grid-template-columns: repeat(6, minmax(0, 1fr)); } }
@media (max-width: 820px)  { .sectors-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
@media (max-width: 520px)  { .sectors-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }

/* ===========================
      CATÁLOGO (abaixo dos setores)
=========================== */
.catalog-shell{
  margin-top: 16px;
  background: rgba(15,23,42,0.55);
  border: 1px solid #1f2937;
  border-radius: 18px;
  padding: 16px;
}
.catalog-title{
  display:flex;
  justify-content:space-between;
  gap:12px;
  align-items:baseline;
  margin-bottom: 10px;
}
.catalog-title h2{
  font-size: 1.1rem;
  font-weight: 650;
}
.catalog-title p{
  color: var(--text-muted);
  font-size: 0.85rem;
}
.catalog-bar{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:flex-end;
  background: rgba(2,6,23,0.85);
  border: 1px solid #111827;
  border-radius: 14px;
  padding: 12px;
}
.catalog-bar label{ font-size:12px; color: var(--text-muted); }
.catalog-bar input[type="file"]{ color: var(--text-muted); max-width: 520px; }
.catalog-btn{
  background:#0f0f11;
  border:1px solid #1f2937;
  color:var(--text-main);
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
  font-weight: 600;
}
.catalog-btn:disabled{ opacity:.5; cursor:not-allowed; }
.catalog-mini{
  display:flex;
  gap:10px;
  align-items:center;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid #111827;
  background: rgba(2,6,23,0.6);
  color: var(--text-muted);
  font-size: 0.85rem;
}
.catalog-status{ margin-top: 10px; color: var(--text-muted); font-size: 13px; }
.catalog-debug{
  margin-top:10px;
  font-size:12px;
  color:var(--text-muted);
  background:#0f0f11;
  border:1px solid #111827;
  border-radius:12px;
  padding:10px;
  max-height:200px;
  overflow:auto;
  display:none;
}
.catalog-grid{
  margin-top: 14px;
  display:grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 12px;
}
.catalog-card{
  background: rgba(3,7,18,0.65);
  border: 1px solid #111827;
  border-radius: 14px;
  padding: 12px;
  min-height: 160px;
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.catalog-thumb{
  width:100%;
  aspect-ratio: 1/1;
  border:1px solid #111827;
  border-radius: 12px;
  background: rgba(2,6,23,0.7);
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.catalog-thumb img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}
.catalog-noimg{
  font-size:12px;
  color: var(--text-muted);
  padding:8px;
  text-align:center;
}
.catalog-name{ font-weight:800; font-size:14px; line-height:1.2; margin:0; word-break:break-word; }
.catalog-price{ font-weight:950; color: var(--accent-green); white-space:nowrap; }

.catalog-pager{
  margin-top: 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding: 12px;
  border:1px solid #111827;
  background: rgba(2,6,23,0.85);
  border-radius: 14px;
}
.catalog-pager .controls{ display:flex; gap:10px; }
.catalog-pager .info{ color: var(--text-muted); font-size: 13px; }

@media (max-width: 1200px){ .catalog-grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
@media (max-width: 900px){ .catalog-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }

/* ===========================
      COMO FUNCIONA (3 PASSOS)
=========================== */
.steps-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 18px;
}
.step-card {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 16px 14px;
  border: 1px solid var(--border-soft);
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.step-badge {
  width: 26px;
  height: 26px;
  border-radius: 999px;
  background: #111827;
  border: 1px solid #1f2937;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  color: var(--text-muted);
}
.step-title { font-size: 0.98rem; font-weight: 500; }
.step-text { font-size: 0.87rem; color: var(--text-muted); }

/* ===========================
      BENEFÍCIOS
=========================== */
.benefits-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 18px;
}
.benefit-card {
  background: var(--bg-card-soft);
  border-radius: 14px;
  padding: 16px 14px;
  border: 1px solid #1f2937;
}
.benefit-label {
  font-size: 0.75rem;
  color: var(--accent-green);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 4px;
}
.benefit-title { font-size: 0.98rem; margin-bottom: 6px; }
.benefit-text { font-size: 0.87rem; color: var(--text-muted); }

/* ===========================
      PASSO A PASSO DETALHADO
=========================== */
.timeline { border-left: 1px solid var(--border-soft); padding-left: 18px; margin-top: 6px; }
.timeline-step { margin-bottom: 16px; position: relative; }
.timeline-dot {
  position: absolute;
  left: -10px;
  top: 4px;
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: var(--accent-green);
  box-shadow: 0 0 0 4px rgba(34,197,94,0.2);
}
.timeline-title { font-size: 0.95rem; font-weight: 500; margin-bottom: 2px; }
.timeline-text { font-size: 0.86rem; color: var(--text-muted); }

/* ===========================
      LISTAGEM DE LOJAS (EXEMPLO)
=========================== */
.partners-strip {
  background: rgba(15,23,42,0.9);
  border-radius: 16px;
  padding: 18px 16px;
  border: 1px solid #1f2937;
}
.partners-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
  font-size: 0.9rem;
}
.partners-logos { display: flex; flex-wrap: wrap; gap: 10px; }
.partner-pill {
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid #1f2937;
  background: #020617;
  font-size: 0.8rem;
  color: var(--text-muted);
}

/* ===========================
      CTA FINAL
=========================== */
.cta-box {
  background: linear-gradient(135deg, #052e16 0, #020617 60%);
  border-radius: 18px;
  padding: 18px 18px;
  border: 1px solid #14532d;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 14px;
  justify-content: space-between;
  margin-top: 8px;
}
.cta-text-main { font-size: 1rem; font-weight: 500; }
.cta-text-sub { font-size: 0.85rem; color: #bbf7d0; }

/* ===========================
      FOOTER
=========================== */
.footer {
  background: #020617;
  color: #d4d4d4;
  margin-top: 40px;
  padding: 40px 16px 20px;
  border-top: 1px solid #020617;
}
.footer-grid {
  max-width: 1400px;
  margin: auto;
  display: grid;
  grid-template-columns: 2fr 1.2fr 1.2fr 1.3fr;
  gap: 32px;
}
.footer-col h3 { margin-bottom: 10px; color: white; font-size: 1rem; }
.footer-logo { font-size: 1.4rem; font-weight: 700; margin-bottom: 8px; }
.footer-logo span { color: var(--accent-green); }
.footer-col p, .footer-col a { font-size: 0.88rem; line-height: 1.4rem; }
.footer-col ul { list-style: none; padding: 0; }
.footer-col li { margin: 6px 0; }
.footer-col a { color: #d4d4d4; text-decoration: none; }
.footer-col a:hover { color: white; }
.footer-tagline { font-size: 0.8rem; color: var(--text-muted); margin-top: 4px; }
.footer-badges { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.footer-badge {
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid #1f2937;
  color: var(--text-muted);
}
.newsletter-input { display: flex; gap: 6px; margin-top: 8px; }
.newsletter-input input {
  flex: 1;
  padding: 7px 8px;
  border-radius: 999px;
  border: 1px solid #1f2937;
  background: #020617;
  color: white;
  font-size: 0.82rem;
}
.newsletter-input input::placeholder { color: #6b7280; }
.newsletter-input button {
  padding: 7px 12px;
  border-radius: 999px;
  border: none;
  background: #1f2937;
  color: white;
  font-size: 0.82rem;
  cursor: pointer;
}
.newsletter-input button:hover { background: #111827; }

.footer-bottom {
  max-width: 1400px;
  margin: 28px auto 0;
  text-align: center;
  padding-top: 16px;
  border-top: 1px solid #1f2937;
  color: #9ca3af;
  font-size: 0.8rem;
}

/* RESPONSIVO GERAL */
@media (max-width: 900px) {
  .header-container { flex-wrap: wrap; }
  .hero { grid-template-columns: minmax(0,1fr); }
  .footer-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
  .info-bar-inner { flex-direction: column; align-items: flex-start; }
}
</style>
</head>

<body>

<header class="top-header">
  <div class="header-container">
    <div class="logo">Preço<span>Vs</span></div>

    <div class="search-box">
      <input id="globalSearch" type="text" placeholder="Pesquisar produtos...">
      <button id="globalSearchBtn" type="button">Buscar</button>
    </div>

    <div class="endereco">
      <span class="end-label">Entrega em:</span>
      <span id="enderecoCliente">Selecionar endereço</span>
    </div>

    <div class="account">
      <img src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" class="icon" alt="Conta">
      <span>Minha Conta</span>
    </div>

    <div class="cart">
      <img src="https://cdn-icons-png.flaticon.com/512/3144/3144456.png" class="icon" alt="Carrinho">
      <span>Carrinho</span>
      <div class="cart-count" id="cartCount">0</div>
    </div>
  </div>
</header>

<div class="info-bar">
  <div class="info-bar-inner">
    <div class="info-pill">Intermediador</div>
    <div>
      Nós não vendemos produtos. <span class="info-highlight">Você escolhe o carrinho ideal</span> e finaliza a compra direto no site do supermercado escolhido.
    </div>
  </div>
</div>

<!-- CARROSSEL (7 BANNERS) -->
<section class="carousel">
  <div class="carousel-track">
    <img src="banner1.png" alt="Banner 1">
    <img src="banner2.png" alt="Banner 2">
    <img src="banner3.png" alt="Banner 3">
    <img src="banner4.png" alt="Banner 4">
    <img src="banner5.png" alt="Banner 5">
    <img src="banner6.png" alt="Banner 6">
    <img src="banner7.png" alt="Banner 7">
  </div>
  <button class="carousel-btn prev" type="button">‹</button>
  <button class="carousel-btn next" type="button">›</button>
</section>

<!-- HERO / CONCEITO -->
<section class="page-section">
  <div class="hero">
    <div class="hero-left">
      <h1>O jeito inteligente de montar seu carrinho <span>sem trocar de mercado toda hora</span>.</h1>
      <p>
        O PreçoVs conecta você a vários supermercados ao mesmo tempo.
        Você escolhe os produtos, nós mostramos quem está ganhando em valor total e onde compensa fechar a compra.
      </p>

      <div class="hero-badges">
        <div class="hero-badge">Não somos supermercado</div>
        <div class="hero-badge">Comparação em tempo quase real*</div>
        <div class="hero-badge">Foco em economia de tempo e dinheiro</div>
      </div>

      <div class="hero-actions">
        <button class="btn-primary" type="button" id="goCatalog">Começar a comparar</button>
        <button class="btn-outline" type="button" id="goHow">Ver como funciona passo a passo</button>
      </div>
    </div>

    <div class="hero-right">
      <div class="hero-right-title">Exemplo de comparação do seu carrinho:</div>

      <div class="hero-compare-row best">
        <span class="mercado">Mercado A</span>
        <span class="valor">R$ 132,70</span>
        <span style="font-size:0.78rem;color:var(--accent-green);">Melhor opção</span>
      </div>
      <div class="hero-compare-row">
        <span class="mercado">Mercado B</span>
        <span class="valor">R$ 141,20</span>
        <span style="font-size:0.78rem;color:var(--text-muted);">Diferença: +R$ 8,50</span>
      </div>
      <div class="hero-compare-row">
        <span class="mercado">Mercado C</span>
        <span class="valor">R$ 149,90</span>
        <span style="font-size:0.78rem;color:var(--text-muted);">Diferença: +R$ 17,20</span>
      </div>

      <div class="hero-legend">
        Você adiciona detergente, leite, arroz... nós atualizamos qual mercado está na frente e quanto você está economizando.
      </div>
    </div>
  </div>

  <!-- SETORES -->
  <div class="sectors-box">
    <div class="sectors-grid">
      <div class="sector-card"><span>Mercearia Salgada</span></div>
      <div class="sector-card"><span>Mercearia Doce</span></div>
      <div class="sector-card"><span>Saudáveis</span></div>
      <div class="sector-card"><span>Bebidas</span></div>
      <div class="sector-card"><span>Perfumaria</span></div>
      <div class="sector-card"><span>Bazar</span></div>
      <div class="sector-card"><span>Limpeza</span></div>
      <div class="sector-card"><span>Frios</span></div>
      <div class="sector-card"><span>Açougue</span></div>
      <div class="sector-card"><span>Padaria</span></div>
      <div class="sector-card"><span>Hortifruti</span></div>
      <div class="sector-card"><span>Congelados</span></div>
    </div>
  </div>

  <!-- CATÁLOGO -->
  <div class="catalog-shell" id="catalogoProdutos">
    <div class="catalog-title">
      <div>
        <h2>Catálogo (Nome + Preço + Imagem)</h2>
        <p>GitHub Pages: o AUTO lê <strong>./PRODUTOS/index.json</strong> e baixa os .xlsx (inclusive subpastas).</p>
      </div>
      <div class="catalog-mini">
        <input id="autoCheck" type="checkbox">
        <label for="autoCheck" style="cursor:pointer;">Auto-carregar ao abrir</label>
      </div>
    </div>

    <div class="catalog-bar">
      <div>
        <label>Opção C: AUTO (GitHub Pages) — usar ./PRODUTOS/index.json</label><br>
        <button class="catalog-btn" id="btnAuto" type="button">AUTO carregar</button>
      </div>

      <div>
        <label>Opção A: selecionar a pasta PRODUTOS (Chrome/Edge)</label><br>
        <input id="dirPicker" type="file" webkitdirectory multiple accept=".xlsx,.xlsm">
      </div>

      <div>
        <label>Opção B: selecionar arquivos manualmente</label><br>
        <input id="filePicker" type="file" multiple accept=".xlsx,.xlsm">
      </div>

      <button class="catalog-btn" id="btnLoad" type="button">Carregar</button>
    </div>

    <div class="catalog-status" id="status"></div>
    <div class="catalog-debug" id="debug"></div>

    <div class="catalog-grid" id="grid"></div>

    <div class="catalog-pager">
      <div class="controls">
        <button class="catalog-btn" id="prevBtn" type="button">Voltar</button>
        <button class="catalog-btn" id="nextBtn" type="button">Próximo</button>
        <button class="catalog-btn" id="toggleDebug" type="button">Debug</button>
      </div>
      <div class="info" id="pageInfo">Página 0 / 0</div>
    </div>
  </div>
</section>

<!-- COMO FUNCIONA -->
<section class="page-section" id="comoFunciona">
  <h2 class="section-title">Como o PreçoVs funciona na prática</h2>
  <p class="section-subtitle">
    O foco é simples: você monta o carrinho, nós organizamos a briga de preços entre os mercados.
  </p>

  <div class="steps-grid">
    <div class="step-card">
      <div class="step-badge">1</div>
      <div class="step-title">Você escolhe o que quer comprar</div>
      <div class="step-text">
        Pesquise pelos produtos (ex.: detergente, leite, arroz) e vá adicionando ao carrinho.
        Não precisa escolher mercado agora.
      </div>
    </div>

    <div class="step-card">
      <div class="step-badge">2</div>
      <div class="step-title">Comparamos o carrinho entre mercados</div>
      <div class="step-text">
        A cada item, o sistema mostra qual supermercado está ganhando no total e qual a diferença de valor entre eles.
      </div>
    </div>

    <div class="step-card">
      <div class="step-badge">3</div>
      <div class="step-title">Você decide onde fechar o pedido</div>
      <div class="step-text">
        Ao final, você escolhe em qual mercado quer finalizar a compra e é direcionado para concluir direto no site oficial dele.
      </div>
    </div>
  </div>
</section>

<!-- BENEFÍCIOS -->
<section class="page-section">
  <h2 class="section-title">Por que usar o PreçoVs?</h2>
  <p class="section-subtitle">
    Menos planilha, menos print de oferta, menos dor de cabeça. Mais clareza e decisão rápida.
  </p>

  <div class="benefits-grid">
    <div class="benefit-card">
      <div class="benefit-label">Economia real</div>
      <div class="benefit-title">Você vê o total, não só o preço da promoção</div>
      <div class="benefit-text">
        Promoção isolada engana. O PreçoVs olha o carrinho completo, mostrando onde o conjunto da compra está mais barato.
      </div>
    </div>

    <div class="benefit-card">
      <div class="benefit-label">Tempo</div>
      <div class="benefit-title">Sem ficar pulando de app em app</div>
      <div class="benefit-text">
        Em vez de abrir três, quatro mercados diferentes, você concentra a análise em um único lugar.
      </div>
    </div>

    <div class="benefit-card">
      <div class="benefit-label">Estratégia</div>
      <div class="benefit-title">Decisão consciente, não no impulso</div>
      <div class="benefit-text">
        Ao ver a diferença clara entre os mercados, fica muito mais fácil saber se vale pagar um pouco mais por conveniência.
      </div>
    </div>

    <div class="benefit-card">
      <div class="benefit-label">Transparência</div>
      <div class="benefit-title">Comparador, não vendedor</div>
      <div class="benefit-text">
        Não armazenamos estoque, não entregamos produtos. Nosso foco é organizar informação e direcionar você para concluir a compra no site do mercado.
      </div>
    </div>
  </div>
</section>

<!-- PASSO A PASSO DETALHADO -->
<section class="page-section">
  <h2 class="section-title">Passo a passo rápido</h2>
  <p class="section-subtitle">Do primeiro acesso até o fechamento do pedido em poucos movimentos.</p>

  <div class="timeline">
    <div class="timeline-step">
      <div class="timeline-dot"></div>
      <div class="timeline-title">1. Informe seu endereço ou região</div>
      <div class="timeline-text">Assim filtramos apenas supermercados que fazem sentido para sua área de entrega.</div>
    </div>

    <div class="timeline-step">
      <div class="timeline-dot"></div>
      <div class="timeline-title">2. Comece a pesquisar produtos</div>
      <div class="timeline-text">Use a barra de busca, vá adicionando itens ao carrinho e observe qual mercado assume a liderança.</div>
    </div>

    <div class="timeline-step">
      <div class="timeline-dot"></div>
      <div class="timeline-title">3. Ajuste marcas e quantidades</div>
      <div class="timeline-text">Troque marcas, mude quantidades e veja o impacto direto no total de cada supermercado.</div>
    </div>

    <div class="timeline-step">
      <div class="timeline-dot"></div>
      <div class="timeline-title">4. Escolha o mercado vencedor</div>
      <div class="timeline-text">No final, você decide onde faz mais sentido finalizar a compra e é direcionado para concluir o pedido no site do mercado escolhido.</div>
    </div>
  </div>

  <div class="cta-box">
    <div>
      <div class="cta-text-main">Pronto para testar na prática?</div>
      <div class="cta-text-sub">
        Monte um carrinho simples (ex.: higiene + café da manhã) e veja qual mercado ganha em menos de 2 minutos.
      </div>
    </div>
    <button class="btn-primary" type="button">Montar meu primeiro carrinho</button>
  </div>
</section>

<!-- LISTAGEM DE LOJAS (EXEMPLO) -->
<section class="page-section">
  <div class="partners-strip">
    <div class="partners-header">
      <div>
        <strong>Lojas exibidas na comparação</strong><br>
        <span style="font-size:0.8rem;color:var(--text-muted);">
          Exemplo ilustrativo. As lojas exibidas podem variar por região e disponibilidade online.
        </span>
      </div>
      <div style="font-size:0.8rem;color:var(--text-muted);">
        Não temos vínculo com as lojas: apenas organizamos preços e redirecionamos para os sites oficiais.
      </div>
    </div>

    <div class="partners-logos">
      <div class="partner-pill">Loja A • Bairro</div>
      <div class="partner-pill">Loja B • Atacado</div>
      <div class="partner-pill">Loja C • Rede local</div>
      <div class="partner-pill">Loja D • Express</div>
    </div>
  </div>
</section>

<!-- RODAPÉ -->
<footer class="footer">
  <div class="footer-grid">
    <div class="footer-col">
      <div class="footer-logo">Preço<span>Vs</span></div>
      <p class="footer-tagline">
        Plataforma de comparação inteligente entre supermercados.
        Nosso foco é organizar informação para que você decida melhor onde comprar.
      </p>
      <div class="footer-badges">
        <div class="footer-badge">Comparador de preços</div>
        <div class="footer-badge">Sem estoque próprio</div>
        <div class="footer-badge">Foco em economia</div>
      </div>
    </div>

    <div class="footer-col">
      <h3>Para consumidores</h3>
      <ul>
        <li><a href="#">Como funciona a comparação</a></li>
        <li><a href="#">Dicas para montar carrinho inteligente</a></li>
        <li><a href="#">Perguntas frequentes</a></li>
        <li><a href="#">Central de atendimento</a></li>
      </ul>
    </div>

    <div class="footer-col">
      <h3>Para mercados e lojas</h3>
      <ul>
        <li><a href="#">Como aparecer na comparação</a></li>
        <li><a href="#">Guia técnico (links e catálogo)</a></li>
        <li><a href="#">Atualização de informações públicas</a></li>
        <li><a href="#">Contato técnico</a></li>
      </ul>
    </div>

    <div class="footer-col">
      <h3>Informações legais</h3>
      <ul>
        <li><a href="#">Política de Privacidade</a></li>
        <li><a href="#">Termos de Uso</a></li>
        <li><a href="#">Política de Cookies</a></li>
      </ul>
      <h3 style="margin-top:14px;">Atualizações</h3>
      <p style="font-size:0.82rem;">Receba novidades sobre novas lojas disponíveis, melhorias de busca e recursos.</p>
      <div class="newsletter-input">
        <input type="email" placeholder="Seu e-mail">
        <button type="button">Assinar</button>
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    <p>© <span id="ano"></span> PreçoVs — Todos os direitos reservados. Não somos supermercado, não vendemos produtos.</p>
  </div>
</footer>

<script>
/* ===========================
   FIXOS / UI
=========================== */
document.getElementById("ano").textContent = new Date().getFullYear();

// carrossel
let index = 0;
const track = document.querySelector('.carousel-track');
const slides = document.querySelectorAll('.carousel img');
const total = slides.length;

function updateCarousel() { track.style.transform = `translateX(-${index * 100}%)`; }
document.querySelector('.next').onclick = () => { index = (index + 1) % total; updateCarousel(); };
document.querySelector('.prev').onclick = () => { index = (index - 1 + total) % total; updateCarousel(); };
setInterval(() => { index = (index + 1) % total; updateCarousel(); }, 5000);

// botões do hero
document.getElementById('goCatalog').addEventListener('click', () => {
  document.getElementById('catalogoProdutos').scrollIntoView({ behavior: 'smooth', block: 'start' });
});
document.getElementById('goHow').addEventListener('click', () => {
  document.getElementById('comoFunciona').scrollIntoView({ behavior: 'smooth', block: 'start' });
});

/* ===========================
   CATÁLOGO (XLSX + AUTO)
=========================== */
const PAGE_SIZE = 50; // 5x10
let itemsAll = [];
let items = [];
let page = 1;
let pages = 1;

const dirPicker = document.getElementById('dirPicker');
const filePicker = document.getElementById('filePicker');
const btnLoad = document.getElementById('btnLoad');
const btnAuto = document.getElementById('btnAuto');
const autoCheck = document.getElementById('autoCheck');
const statusEl = document.getElementById('status');
const debugEl = document.getElementById('debug');
const gridEl = document.getElementById('grid');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const pageInfo = document.getElementById('pageInfo');
const toggleDebug = document.getElementById('toggleDebug');

const globalSearch = document.getElementById('globalSearch');
const globalSearchBtn = document.getElementById('globalSearchBtn');

function setStatus(msg){ statusEl.textContent = msg; }
function setDebug(html){ debugEl.innerHTML = html; }
function escapeHtml(s){
  return (s ?? '').toString()
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}

// IMPORTANTE: preserva "/"
function encodePath(p){
  return (p || '')
    .split('/')
    .filter(Boolean)
    .map(encodeURIComponent)
    .join('/');
}

function resolveImgPath(raw){
  const img = (raw || '').toString().trim();
  if (!img) return '';
  const low = img.toLowerCase();
  if (low.startsWith('http://') || low.startsWith('https://') || low.startsWith('data:') || low.startsWith('blob:')) return img;
  if (img.startsWith('/')) return img;
  if (img.startsWith('./') || img.startsWith('../')) return img;
  return './' + img.replace(/^\/+/,'');
}

function applySearch(){
  const q = (globalSearch.value || '').trim().toLowerCase();
  if (!q){
    items = [...itemsAll];
  }else{
    items = itemsAll.filter(p => (p.nome || '').toLowerCase().includes(q));
  }
  page = 1;
  render();
}

function render(){
  pages = Math.max(1, Math.ceil(items.length / PAGE_SIZE));
  if (page > pages) page = pages;

  const start = (page - 1) * PAGE_SIZE;
  const end = start + PAGE_SIZE;
  const slice = items.slice(start, end);

  gridEl.innerHTML = slice.map((p, idx) => {
    const img = resolveImgPath(p.imagem);
    const hasImg = !!img;
    const safeImg = escapeHtml(img);
    const cid = `img_${page}_${idx}`;

    return `
      <div class="catalog-card">
        <div class="catalog-thumb" id="${cid}_wrap">
          ${hasImg
            ? `<img id="${cid}" src="${safeImg}" alt="Imagem do produto" loading="lazy"
                 onerror="(function(){
                   const w=document.getElementById('${cid}_wrap');
                   if(w) w.innerHTML='<div class=&quot;catalog-noimg&quot;>Imagem indisponível</div>';
                 })();">`
            : `<div class="catalog-noimg">Sem imagem</div>`
          }
        </div>
        <p class="catalog-name">${escapeHtml(p.nome)}</p>
        <div class="catalog-price">${escapeHtml(p.preco)}</div>
      </div>
    `;
  }).join('');

  pageInfo.textContent = `Página ${page} / ${pages} — ${items.length} itens`;
  prevBtn.disabled = page <= 1;
  nextBtn.disabled = page >= pages;
}

prevBtn.addEventListener('click', () => { if (page > 1){ page--; render(); }});
nextBtn.addEventListener('click', () => { if (page < pages){ page++; render(); }});

toggleDebug.addEventListener('click', () => {
  debugEl.style.display = (debugEl.style.display === 'none' ? 'block' : 'none');
});

function extOk(name){
  const n = (name || '').toLowerCase();
  return n.endsWith('.xlsx') || n.endsWith('.xlsm');
}

function gatherFiles(){
  const a = Array.from(dirPicker.files || []);
  const b = Array.from(filePicker.files || []);
  const merged = [...a, ...b].filter(f => extOk(f.name));

  const seen = new Set();
  const out = [];
  for (const f of merged){
    const key = `${f.webkitRelativePath||''}||${f.name}||${f.size}`;
    if (seen.has(key)) continue;
    seen.add(key);
    out.push(f);
  }
  return out;
}

/* ===========================
   ZIP / XLSX parser (sem libs)
=========================== */
function u16(dv, off){ return dv.getUint16(off, true); }
function u32(dv, off){ return dv.getUint32(off, true); }

function findEOCD(u8){
  const min = Math.max(0, u8.length - 65557);
  for (let i = u8.length - 22; i >= min; i--){
    if (u8[i] === 0x50 && u8[i+1] === 0x4b && u8[i+2] === 0x05 && u8[i+3] === 0x06){
      return i;
    }
  }
  return -1;
}

function parseZipEntries(u8){
  const dv = new DataView(u8.buffer, u8.byteOffset, u8.byteLength);
  const eocd = findEOCD(u8);
  if (eocd < 0) throw new Error('Não é ZIP válido (EOCD não encontrado).');

  const totalEntries = u16(dv, eocd + 10);
  const cdOffset = u32(dv, eocd + 16);

  let ptr = cdOffset;
  const entries = new Map();

  for (let i = 0; i < totalEntries; i++){
    const sig = u32(dv, ptr);
    if (sig !== 0x02014b50) throw new Error('Central Directory inválido.');

    const method = u16(dv, ptr + 10);
    const compSize = u32(dv, ptr + 20);
    const fnLen = u16(dv, ptr + 28);
    const exLen = u16(dv, ptr + 30);
    const cmLen = u16(dv, ptr + 32);
    const lho = u32(dv, ptr + 42);

    const nameBytes = u8.slice(ptr + 46, ptr + 46 + fnLen);
    const name = new TextDecoder('utf-8').decode(nameBytes);

    const lSig = u32(dv, lho);
    if (lSig !== 0x04034b50) throw new Error('Local header inválido.');
    const lFnLen = u16(dv, lho + 26);
    const lExLen = u16(dv, lho + 28);
    const dataStart = lho + 30 + lFnLen + lExLen;

    entries.set(name, { name, method, compressedSize: compSize, dataStart });
    ptr = ptr + 46 + fnLen + exLen + cmLen;
  }
  return entries;
}

async function inflateRaw(u8){
  if (typeof DecompressionStream === 'undefined'){
    throw new Error('DecompressionStream não disponível. Atualize o Chrome/Edge.');
  }
  let ds;
  try{ ds = new DecompressionStream('deflate-raw'); }
  catch{ ds = new DecompressionStream('deflate'); }

  const stream = new Blob([u8]).stream().pipeThrough(ds);
  const ab = await new Response(stream).arrayBuffer();
  return new Uint8Array(ab);
}

async function readZipText(zipU8, entries, path){
  const e = entries.get(path);
  if (!e) return null;

  const comp = zipU8.slice(e.dataStart, e.dataStart + e.compressedSize);
  let out;
  if (e.method === 0) out = comp;
  else if (e.method === 8) out = await inflateRaw(comp);
  else throw new Error(`Método ZIP não suportado: ${e.method}`);

  return new TextDecoder('utf-8').decode(out);
}

function parseXml(text){
  const doc = new DOMParser().parseFromString(text, 'application/xml');
  if (doc.getElementsByTagName('parsererror').length) throw new Error('XML inválido dentro do XLSX.');
  return doc;
}

function norm(s){
  return (s ?? '')
    .toString()
    .trim()
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g,'')
    .replace(/\s+/g,'');
}

function colToIndex(col){
  let n = 0;
  for (let i = 0; i < col.length; i++){
    n = n * 26 + (col.charCodeAt(i) - 64);
  }
  return n - 1;
}

function cellRefToColIndex(ref){
  const m = (ref || '').match(/[A-Z]+/);
  if (!m) return 0;
  return colToIndex(m[0]);
}

function readSharedStrings(doc){
  const out = [];
  const sis = doc.getElementsByTagName('si');
  for (const si of sis){
    const ts = si.getElementsByTagName('t');
    let s = '';
    for (const t of ts) s += (t.textContent ?? '');
    out.push(s);
  }
  return out;
}

function explodeRowDense(arr){
  const dense = arr.map(x => (x ?? '').toString().trim());
  const nonEmpty = dense.filter(x => x !== '');
  if (nonEmpty.length === 1){
    const cell = nonEmpty[0];
    if (cell.includes('\t') || cell.includes(';') || cell.includes(',')){
      return cell.split(/\t|;|,/).map(x => (x ?? '').toString().trim());
    }
  }
  let end = dense.length;
  while (end > 0 && dense[end-1] === '') end--;
  return dense.slice(0, end);
}

function findHeaderIndex(rows){
  const limit = Math.min(200, rows.length);
  let best = { idx: -1, score: 0 };

  for (let i = 0; i < limit; i++){
    const r = explodeRowDense(rows[i]);
    if (!r.length) continue;
    const cells = r.map(norm);

    const hasNome = cells.some(c => c === 'nome' || c.includes('nome') || c.includes('produto') || c.includes('descricao'));
    const hasPreco = cells.some(c => c === 'preco' || c.includes('preco') || c.includes('valor') || c.includes('price'));
    const hasImg  = cells.some(c => c === 'imagem' || c.includes('imagem') || c.includes('foto') || c.includes('image') || c === 'img');

    let score = 0;
    if (hasNome) score += 3;
    if (hasPreco) score += 3;
    if (hasImg) score += 1;

    if (score > best.score) best = { idx: i, score };
  }
  return best.score >= 6 ? best.idx : -1;
}

function detectCols(headerRow){
  const r = explodeRowDense(headerRow);
  const h = r.map(norm);

  const idxNome = h.findIndex(x => x === 'nome' || x.includes('nome') || x.includes('produto') || x.includes('descricao'));
  const idxPreco = h.findIndex(x => x === 'preco' || x.includes('preco') || x.includes('valor') || x.includes('price'));
  const idxImg  = h.findIndex(x => x === 'imagem' || x.includes('imagem') || x.includes('foto') || x.includes('image') || x === 'img');

  return { nome: idxNome >= 0 ? idxNome : 2, preco: idxPreco >= 0 ? idxPreco : 3, img: idxImg >= 0 ? idxImg : 4 };
}

function sheetToRows(sheetDoc, sharedStrings){
  const rowsOut = [];
  const rowNodes = sheetDoc.getElementsByTagName('row');

  for (const row of rowNodes){
    const cellNodes = row.getElementsByTagName('c');
    let maxCol = -1;
    const map = new Map();

    for (const c of cellNodes){
      const ref = c.getAttribute('r') || '';
      const colIdx = cellRefToColIndex(ref);
      if (colIdx > maxCol) maxCol = colIdx;

      const t = c.getAttribute('t');
      let val = '';

      if (t === 's'){
        const v = c.getElementsByTagName('v')[0];
        const idx = v ? parseInt(v.textContent || '0', 10) : 0;
        val = sharedStrings[idx] ?? '';
      }else if (t === 'inlineStr'){
        const isT = c.getElementsByTagName('t')[0];
        val = isT ? (isT.textContent ?? '') : '';
      }else{
        const v = c.getElementsByTagName('v')[0];
        val = v ? (v.textContent ?? '') : '';
      }

      map.set(colIdx, val);
    }

    const arr = new Array(Math.max(0, maxCol + 1)).fill('');
    for (const [k, v] of map.entries()) arr[k] = v;
    rowsOut.push(arr);
  }
  return rowsOut;
}

async function parseXlsxCatalog(fileLike){
  const zipU8 = new Uint8Array(await fileLike.arrayBuffer());
  const entries = parseZipEntries(zipU8);

  let sharedStrings = [];
  const ssText = await readZipText(zipU8, entries, 'xl/sharedStrings.xml');
  if (ssText){
    try{ sharedStrings = readSharedStrings(parseXml(ssText)); }catch{ sharedStrings = []; }
  }

  const sheetPaths = [];
  for (const k of entries.keys()){
    if (k.startsWith('xl/worksheets/') && k.endsWith('.xml')) sheetPaths.push(k);
  }
  sheetPaths.sort();

  for (const sp of sheetPaths){
    const sText = await readZipText(zipU8, entries, sp);
    if (!sText) continue;

    let doc;
    try{ doc = parseXml(sText); }catch{ continue; }

    const rows = sheetToRows(doc, sharedStrings);
    if (!rows.length) continue;

    const headerIdx = findHeaderIndex(rows);
    if (headerIdx < 0) continue;

    const cols = detectCols(rows[headerIdx]);

    const out = [];
    let emptyStreak = 0;

    for (let i = headerIdx + 1; i < rows.length; i++){
      const r = explodeRowDense(rows[i]);
      const nome = (r[cols.nome] ?? '').toString().trim();
      const preco = (r[cols.preco] ?? '').toString().trim();
      const imagem = (r[cols.img] ?? '').toString().trim();

      if (!nome){
        emptyStreak++;
        if (emptyStreak >= 40) break;
        continue;
      }
      emptyStreak = 0;
      out.push({ nome, preco, imagem });
    }

    if (out.length){
      return { items: out, sheet: sp, headerLine: headerIdx + 1 };
    }
  }

  return { items: [], sheet: '', headerLine: -1 };
}

function dedupeProducts(arr){
  const seen = new Set();
  return arr.filter(p => {
    const k = `${p.nome}||${p.preco}||${p.imagem}`;
    if (seen.has(k)) return false;
    seen.add(k);
    return true;
  });
}

async function loadFromFiles(fileLikes, labelPrefix){
  if (!fileLikes.length){
    setStatus('0 arquivos .xlsx/.xlsm selecionados.');
    itemsAll = []; items = []; page = 1; render();
    setDebug('');
    return;
  }

  setStatus(`Lendo ${fileLikes.length} arquivo(s)...`);
  const lines = [];
  let merged = [];

  let ok = 0, empty = 0, err = 0;

  for (const f of fileLikes){
    try{
      const res = await parseXlsxCatalog(f);
      if (res.items.length){
        merged.push(...res.items);
        ok++;
        lines.push(`${labelPrefix}${f.name} -> OK (${res.items.length}) | ${res.sheet} | cabeçalho linha ${res.headerLine}`);
      }else{
        empty++;
        lines.push(`${labelPrefix}${f.name} -> SEM DADOS (não achei cabeçalho Nome/Preco/Imagem)`);
      }
    }catch(e){
      err++;
      lines.push(`${labelPrefix}${f.name} -> ERRO: ${e.message || e}`);
      console.error(e);
    }
    setStatus(`Progresso: OK=${ok} | vazios=${empty} | erros=${err} | itens=${merged.length}`);
  }

  merged = dedupeProducts(merged);
  itemsAll = merged;
  applySearch();

  setStatus(`Final: arquivos=${fileLikes.length} | OK=${ok} | vazios=${empty} | erros=${err} | produtos=${itemsAll.length}`);
  setDebug(lines.slice(0, 160).map(escapeHtml).join('<br>') + (lines.length > 160 ? `<br>... +${lines.length-160}` : ''));
}

btnLoad.addEventListener('click', async () => {
  const files = gatherFiles();
  await loadFromFiles(files, '');
});

// Busca do topo filtra o catálogo
globalSearch.addEventListener('input', () => applySearch());
globalSearchBtn.addEventListener('click', () => applySearch());

// AUTO via index.json
async function fetchJsonSafe(url){
  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error(`HTTP ${res.status} em ${url}`);
  return await res.json();
}

function normalizeIndexJson(j){
  if (Array.isArray(j)) return j;
  if (j && Array.isArray(j.files)) return j.files;
  if (j && Array.isArray(j.arquivos)) return j.arquivos;
  return [];
}

async function autoLoad(){
  const t = Date.now();
  setStatus('AUTO: lendo ./PRODUTOS/index.json ...');

  let idx;
  try{
    idx = await fetchJsonSafe(`./PRODUTOS/index.json?v=${t}`);
  }catch(e){
    setStatus(`AUTO falhou: não achei ./PRODUTOS/index.json (${e.message || e})`);
    return;
  }

  const names = normalizeIndexJson(idx).filter(n => typeof n === 'string' && extOk(n));
  if (!names.length){
    setStatus('AUTO: index.json vazio ou sem .xlsx/.xlsm.');
    return;
  }

  setStatus(`AUTO: baixando ${names.length} arquivo(s) de ./PRODUTOS ...`);
  const virtualFiles = [];
  const lines = [];

  for (const name of names){
    const safeName = name.replace(/^\/+/,'');
    const url = `./PRODUTOS/${encodePath(safeName)}?v=${t}`;

    try{
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      const ab = await r.arrayBuffer();

      virtualFiles.push({ name: safeName, arrayBuffer: async () => ab });
      lines.push(`AUTO baixou: ${safeName} (${ab.byteLength} bytes)`);
      setStatus(`AUTO: baixados ${virtualFiles.length}/${names.length} ...`);
    }catch(e){
      lines.push(`AUTO ERRO: ${safeName} -> ${e.message || e}`);
    }
  }

  setDebug(lines.map(escapeHtml).join('<br>'));

  if (!virtualFiles.length){
    setStatus('AUTO: não baixei nenhum .xlsx. Confira nomes e se os arquivos existem em /PRODUTOS.');
    return;
  }

  await loadFromFiles(virtualFiles, 'AUTO: ');
}

btnAuto.addEventListener('click', autoLoad);

// init
setStatus('Pronto. No GitHub Pages use AUTO (index.json). Opção A/B continuam funcionando manualmente.');
render();

// auto-check persistente
try{
  autoCheck.checked = (localStorage.getItem('pv_auto') === '1');
  autoCheck.addEventListener('change', () => {
    localStorage.setItem('pv_auto', autoCheck.checked ? '1' : '0');
  });
  if (autoCheck.checked) autoLoad();
}catch{}
</script>

</body>
</html>
